<script src="//www.gstatic.com/cast/sdk/libs/receiver/2.0.0/cast_receiver.js"></script>

<h1 id="test" style="color: white; font-size: 60px;">This is a test</h1>

<script>
window.onload = function() {
      window.castReceiverManager = cast.receiver.CastReceiverManager.getInstance();
      window.castReceiverManager.La =function(a,b){
      // if("urn:x-cast:com.google.cast.system"==a)throw Error("Protected namespace");
          if(0!=a.lastIndexOf("urn:x-cast:",0))throw Error("Invalid namespace prefix");
          if(!this.u[a]){
              if(this.Jc)throw Error("New namespaces can not be requested after start has been called");
              this.u[a]=new N(a,this.ba,Wa(this.Y),b);
              Kb(this,wa(Lb,this.u[a]))
          }
          if(b&&this.u[a].ua!=b)throw Error("Invalid messageType for the namespace");
          return this.u[a]
      }
      castReceiverManager.onReady = function(event) {
        window.castReceiverManager.setApplicationState('Reciever ready...');
      };
      // messages on a custom namespace
      var ns = 'urn:x-cast:dashboard.com.framework';
      window.messageBus = window.castReceiverManager.getCastMessageBus(ns);

      var nss = ['urn:x-cast:com.google.cast.media',
                'urn:x-cast:com.google.cast.broadcast',
                'urn:x-cast:com.google.cast.debugoverlayer',
                'urn:x-cast:com.google.cast.inject',
                'urn:x-cast:com.google.cast.system'];
      window.busses = [];
      for(var i = 0; i < nss.length; i++){
            window.busses.push(window.castReceiverManager.getCastMessageBus(nss[i]));
            window.busses.onMessage = function(e){
                console.log(e);
            }
      }



    // var player = {
    //     getSecondsEpoch:  function(){
    //         return new Date().getTime()/1000;
    //     },
    //     startTime: 0,
    //     getRelativeTime: function(){
    //         return this.getSecondsEpoch() - this.startTime;
    //     },
    //     getCurrentTimeSec: function(){
    //         var relativeTime = this.getRelativeTime();
    //         var currentTime = 0;
    //         if(relativeTime > 3){
    //             currentTime = relativeTime - 3;
    //         }
    //         console.log('getCurrentTimeSec '+currentTime);
    //         return currentTime;
    //     },
    //     mState:null,
    //     editTracksInfo: function(data){
    //         console.log('editTracksInfo'+data);
    //     },
    //     getDurationSec: function(){
    //         console.log('getDurationSec');
    //         return 120;
    //     },
    //     getState: function(){
    //         var state =  'PLAYING';
    //         console.log('getState '+state);
    //         return state;
    //     },
    //     getVolume: function(){
    //         var volume = new cast.receiver.media.Volume();
    //         console.log('getVolume '+volume);
    //         return volume;
    //     },
    //     load: function(contentId, autoplay, opt_time, opt_tracksInfo, opt_onlyLoadTracks){
    //         console.log('load '+contentId+' autoplay: '+autoplay);
    //     },
    //     pause: function(){
    //         console.log('pause');
    //     },
    //     play: function(){
    //         console.log('play');
    //     },
    //     mEndedCallback:null,
    //     registerEndedCallback: function(endedCallback){
    //         console.log('registerEndedCallback(endedCallback)');
    //     },
    //     mErrorCallback:null,
    //     registerErrorCallback: function(errorCallback){
    //         console.log('registerErrorCallback(errorCallback)');
    //     },
    //     mLoadCallback:null,
    //     registerLoadCallback: function(loadCallback){
    //         console.log('registerLoadCallback(loadCallback)');
    //     },
    //     reset: function(){
    //         console.log('reset');
    //     },
    //     seek: function(){
    //         console.log('seek');
    //     },
    //     setVolume: function(volume){
    //         console.log('setVolume '+volume);
    //     },
    //     unregisterEndedCallback: function(){
    //         console.log('unregisterEndedCallback');
    //     },
    //     unregisterErrorCallback: function(){
    //         console.log('unregisterErrorCallback');
    //     },
    //     unregisterLoadCallback: function(){
    //         console.log('unregisterLoadCallback');
    //     },
    //     init: function(){
    //         console.log('INIT');
    //     }
    // }
    // window.player = player;
    // window.meadiaManager = new cast.receiver.MediaManager(player);


      window.messageBus.onMessage = function(e) {
        // var msg = JSON.parse(e.data);
        $('#test').text(e.data);

        // if(msg.hasOwnProperty('url')){
            // window.location = msg.url;
        // }


        //document.getElementById('test').innerHTML = e.data;
        //window.messageBus.send(e.senderId, 'ok')
      };
      // initialize CastReceiverManager
      window.castReceiverManager.start({statusText: 'Reciever starting...'});
};
</script>
