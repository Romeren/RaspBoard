<div class="top"></div>
<div class="buttom right"></div>
<style type="text/css">
#slideshow {
    height: 50%;
}

#slideshow div {
    max-width: 100%;
    max-height: 100%;
    position:absolute;
    left:0;
    top: 0%;
    -webkit-transition: all 8s ease-in-out;
    background-size: cover;
    background-repeat: no-repeat;
    /*-webkit-transition: left 5s;*/
    /*-webkit-transition: opacity 2s ease-in-out;
    -moz-transition: opacity 2s ease-in-out;
    -o-transition: opacity 2s ease-in-out;
    transition: opacity 2s ease-in-out*/
}

#slideshow div.top{
    max-width: 100%;
    max-height: 100%;
    width: 100%;
    height: 100%;
    z-index: 1;
    opacity: 1;
}

#slideshow div.buttom {
    z-index: 0;
    opacity: 1;
    width: 0px;
    height: 0px;
    top: 50%;
}

#slideshow div.left {
    left: -5%;
    /*-webkit-transform: translate(-100%, 0);*/
}
#slideshow div.right {
    left: 100%;
    /*-webkit-transform: translate(100%, 0);*/
}


</style>
<script>
var waitTime = 10000;
var transitionTime = 9000;
var loadTime = 3000;
function get_image_url(callback){
    $.ajax({
        type: 'GET',
        url: '{{ context.references.random_image[0].address }}',
        success: function(res){
            callback(res);
        },
        error: function(err){
            console.log(err);
            callback(null);
        }
    });
}

function set_image(url, callback){
    var btm = $('#slideshow .buttom');
    // btm[0].src = url;
    btm.css('background-image', 'url("' + url + '")');
    transition(callback);
}

function transition(callback){
    setTimeout(function(){
        var buttom = $('#slideshow .buttom');
        var top = $('#slideshow .top');
        buttom.attr('class', 'top');
        top.attr('class', 'buttom left');
        setTimeout(function(){
            var btm = $('#slideshow .buttom');
            // btm[0].src = "";
            btm.css("background-image",'None');
            btm.attr('class', 'buttom right');
            setTimeout(function(){
                callback()
            }, waitTime);
        }, transitionTime); // transition time
    },loadTime); // load image time
}

function slideshow_recursion(){
    get_image_url(function(url){
        if(url != null){
            set_image(url, function(){
                slideshow_recursion();
            });
        }else{
            setTimeout(slideshow_recursion(),3000);
        }
    });
}

$(function(){
    slideshow_recursion();
});
</script>
